---
layout: post
title: "动态内存分配（dynamic allocation）"
date: 2018-05-02
excerpt: "2018-05-02 动态内存分配."
tags: [C++, 动态内存分配]
comments: true
---

## **动态内存分配（dynamic allocation）** 

C/C++定义了4个内存区间：
代码区，全局变量与静态变量区，局部变量区即栈区，动态存储区，即堆（heap）区或自由存储区（free store）。

1. 静态存储分配和动态存储分配：
* 通常定义变量（或对象），编译器在编译时都可以根据该变量（或对象）的类型知道所需内存空间的大小，从而系统在适当的时候为他们分配确定的存储空间。这种内存分配称为静态存储分配；
* 有些操作对象只在程序运行时才能确定，这样编译时就无法为他们预定存储空间，只能在程序运行时，系统根据运行时的要求进行内存分配，这种方法称为动态存储分配。所有动态存储分配都在堆区中进行。

2. 堆空间申请、释放演示：
* 用初始化式(initializer)来显式初始化
{% highlight python %}
int *pi=new int(0);
{% endhighlight %}
* 当pi生命周期结束时，必须释放pi所指向的目标：
{% highlight python %}
         delete pi;
{% endhighlight %}
注意这时释放了pi所指的目标的内存空间，也就是撤销了该目标，称动态内存释放（dynamic memory deallocation），但指针pi本身并没有撤销，它自己仍然存在，该指针所占内存空间并未释放。

4. 在堆中建立动态一维数组

* 申请数组空间：
指针变量名=new 类型名[下标表达式];
注意：“下标表达式”不是常量表达式，即它的值不必在编译时确定，可以在运行时确定。

* 释放数组空间：
delete [ ]指向该数组的指针变量名;
注意：方括号非常重要的，如果delete语句中少了方括号，因编译器认为该指针是指向数组第一个元素的，会产生回收不彻底的问题（只回收了第一个元素所占空间），加了方括号后就转化为指向数组的指针，回收整个数组。delete [ ]的方括号中不需要填数组元素数，系统自知。即使写了，编译器也忽略。


